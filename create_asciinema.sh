#!/bin/bash
# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ñ€ÐµÐ°Ð»Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ð¾Ð¹ asciinema Ð·Ð°Ð¿Ð¸ÑÐ¸
# Ð˜Ð¼Ð¸Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð²Ð²Ð¾Ð´ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ°Ð¼Ð¸

set -e

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${BLUE}  Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ asciinema Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸ÐµÐ¹ Ð‘Ð”${NC}"
echo -e "${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
rm -f db_meta.json demo.cast

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ asciinema
if ! command -v asciinema &> /dev/null; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: asciinema Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
    echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: brew install asciinema"
    exit 1
fi

echo -e "${GREEN}âœ“${NC} asciinema ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
echo ""

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸
MAIN_SCRIPT=$(mktemp)
cat > "$MAIN_SCRIPT" << 'SCRIPT_EOF'
#!/bin/bash

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð°ÐºÐµÑ‚Ð°
echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¿Ð°ÐºÐµÑ‚..."
poetry install
echo ""
sleep 1.5

# Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ Ð²Ð²Ð¾Ð´Ð¾Ð¼ ÐºÐ¾Ð¼Ð°Ð½Ð´
echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."
echo ""
sleep 1

# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Python ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ð²Ð¾Ð´Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ°Ð¼Ð¸
python3 asciinema_demo.py | poetry run database

SCRIPT_EOF

chmod +x "$MAIN_SCRIPT"

echo -e "${YELLOW}Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸:${NC}"
echo "  1. ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð°ÐºÐµÑ‚Ð° (poetry install)"
echo "  2. ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…"
echo "  3. ðŸ“‹ ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸ (help)"
echo "  4. âž• Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ users"
echo "  5. ðŸ‘ï¸  ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð²ÑÐµÑ… Ñ‚Ð°Ð±Ð»Ð¸Ñ†"
echo "  6. âž• Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ products"
echo "  7. ðŸ‘ï¸  ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð²ÑÐµÑ… Ñ‚Ð°Ð±Ð»Ð¸Ñ†"
echo "  8. âž– Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ products"
echo "  9. ðŸ‘ï¸  Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ñ‚Ð°Ð±Ð»Ð¸Ñ†"
echo "  10. ðŸšª Ð’Ñ‹Ñ…Ð¾Ð´ Ð¸Ð· Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹"
echo ""

echo -e "${BLUE}ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÑŒ...${NC}"
echo -e "${YELLOW}(Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÐºÑƒÐ½Ð´)${NC}"
echo ""

# Ð—Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ asciinema
asciinema rec -c "$MAIN_SCRIPT" demo.cast

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ°
rm -f "$MAIN_SCRIPT" db_meta.json

echo ""
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}  âœ… Ð—Ð°Ð¿Ð¸ÑÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°!${NC}"
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo "ðŸ“ Ð¤Ð°Ð¹Ð»: ${BLUE}demo.cast${NC}"
echo ""
echo "ðŸ“¤ Ð”Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° asciinema.org Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ:"
echo -e "   ${BLUE}asciinema upload demo.cast${NC}"
echo ""
echo "ðŸ”— ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð²Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ URL Ð²Ð¸Ð´Ð°:"
echo "   https://asciinema.org/a/XXXXX"
echo ""
echo "ðŸ“ Ð—Ð°Ñ‚ÐµÐ¼ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ ${YELLOW}YOUR_RECORDING_ID${NC} Ð² README.md Ð½Ð° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ð¹ ID"
echo ""
